<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>経路表示アプリ</title>
<style>
  body { font-family: sans-serif; margin: 20px; }
  textarea { width: 300px; height: 100px; }
  #map { width: 100%; height: 400px; margin-top: 10px; }
  button { margin-top: 10px; padding: 5px 10px; }
</style>
</head>
<body>

<h2>目的地を改行区切りで入力してください</h2>
<textarea id="locations" placeholder="例：
富山市ガラス美術館
富山県庁
富山駅
"></textarea><br />
<button onclick="showRoute()">経路を表示</button>

<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCy2qRJaqSJ7TsZFB3u23Bk_EAFNrnMs28&callback=initMap" async defer></script>

<script>
let map;
let directionsService;
let directionsRenderer;

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 10,
    center: { lat: 36.695, lng: 137.213 }, // 富山あたりの中心座標
  });
  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer();
  directionsRenderer.setMap(map);
}

function showRoute() {
  const input = document.getElementById("locations").value.trim();
  if (!input) {
    alert("目的地を入力してください");
    return;
  }
  const places = input.split("\n").map(s => s.trim()).filter(s => s.length > 0);
  if (places.length < 2) {
    alert("目的地は2つ以上入力してください");
    return;
  }

  const origin = places[0];
  const destination = places[places.length - 1];
  const waypoints = places.slice(1, -1).map(location => ({
    location,
    stopover: true
  }));

  directionsService.route(
    {
      origin,
      destination,
      waypoints,
      travelMode: google.maps.TravelMode.DRIVING,
      optimizeWaypoints: false // 入力順通りに表示
    },
    (response, status) => {
      if (status === google.maps.DirectionsStatus.OK) {
        directionsRenderer.setDirections(response);
      } else {
        alert("経路の取得に失敗しました: " + status);
      }
    }
  );
}
</script>

</body>
</html>
