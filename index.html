<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <title>ルート表示（ローカルJSON＋訪問順マーカー）</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family: "Noto Sans JP", system-ui, sans-serif; margin: 0; }
    #map { width: 100%; height: calc(100vh - 100px); }
    header {
      background: #f8f8f8;
      padding: 10px 16px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    header label {
      font-size: 14px;
      margin-right: 4px;
    }
    header input, header select {
      padding: 4px 6px;
      font-size: 14px;
    }
    header button {
      background: #0078ff;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    header button:hover {
      background: #005fcc;
    }
  </style>
</head>
<body>
  <!-- 上部入力フォーム -->
  <header>
    <label>始点:</label>
    <select id="start">
      <option value="富山市">富山市</option>
      <option value="高岡市">高岡市</option>
      <option value="黒部市">黒部市</option>
    </select>

    <label>終点:</label>
    <select id="end">
      <option value="富山市">富山市</option>
      <option value="高岡市">高岡市</option>
      <option value="黒部市">黒部市</option>
    </select>

    <label>出発時刻:</label>
    <input type="time" id="startTime" value="08:00">

    <label>到着時刻:</label>
    <input type="time" id="endTime" value="18:00">

    <button id="showRouteBtn">ルート表示</button>
  </header>

  <div id="map"></div>

  <!-- Google Maps JavaScript API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCy2qRJaqSJ7TsZFB3u23Bk_EAFNrnMs28&libraries=geometry" async defer></script>

  <script>
  let map;
  let routes = {};
  let polylines = [];
  let markers = [];

  const locations = [
"黒部ダム","富山市ガラス美術館","瑞龍寺","雪の大谷","富岩運河環水公園","越中五箇山相倉集落","富山県美術館",
"称名滝","みくりが池","高岡大仏","砺波チューリップ公園","黒部峡谷トロッコ列車","雨晴海岸","富山城","恋人の聖地海王丸パーク",
"富山市役所展望塔","スターバックスコーヒー富山環水公園店","富山市ファミリーパーク","氷見漁港場外市場ひみ番屋街","魚津水族館",
"ほたるいか海上観光集合場所","氷見市潮風ギャラリー藤子不二雄Aアートコレクション","海王丸パーク","ほたるいかミュージアム",
"ますのすし本舗源ますのすしミュージアム","松川遊覧船乗り場（松川茶屋）","新湊大橋","（株）池田屋安兵衛商店健康膳薬都","道の駅雨晴",
"富山ガラス工房","きときと市場とやマルシェGOSHU","北前船回船問屋森家","チューリップ四季彩館","井波別院瑞泉寺","日枝神社",
"富山市科学博物館","富山縣護國神社","菅沼合掌造り集落（南砺市菅沼重要伝統的建造物群保存地区）","富山城址公園","満天の湯富山店",
"富岩水上ライン","おとぎの森館","高岡古城公園","散居村展望台","富山県中央植物園","秋水美術館","金太郎温泉日帰り温泉カルナの館",
"諏訪町本通り","富山県立山カルデラ砂防博物館","富山市郷土博物館","富山港展望台","高岡古城公園動物園","立山","富山市民俗民芸村民俗資料館",
"富山市佐藤記念美術館","高岡おとぎの森公園","高岡市万葉歴史館","ミラージュランド","庄川峡","宇奈月駅","あさひ舟川「春の四重奏」",
"弥陀ヶ原","県民公園太閤山ランド","岩瀬の古い町並み","庄川温泉郷","となみチューリップ公園東門","黒部平","富山県水墨美術館","（有）営農ワイエムアイ",
"桂樹舎・和紙文庫","海の駅蜃気楼","日石寺","勝興寺","八重津浜海水浴場","高志の国文学館","魚津埋没林博物館","射水市大島絵本館",
"閑乗寺公園","富山県立イタイイタイ病資料館","氷見あいやまガーデン","松川公園","牛岳温泉スキー場","梅かまミュージアムU-mei館",
"ミュゼふくおかカメラ館","呉羽山公園","朝日山公園","高岡御車山会館","氷見市海浜植物園シーサイドパーク","高岡城跡","まんがロード",
"高天原温泉","黒部川電気記念館","剱岳","山町筋重要伝統的建造物群保存地区","高岡市美術館","富山二上山","薬師岳"
];

  async function loadAllRoutes() {
    const parts = 10;
    for (let k = 1; k <= parts; k++) {
      const resp = await fetch(`routes_part${k}.json`);
      const data = await resp.json();
      Object.assign(routes, data);
    }
    console.log("全ルート読み込み完了:", Object.keys(routes).length, "件");
  }

  function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 36.695, lng: 137.213 },
      zoom: 10,
    });
  }

  function drawRouteOnMap(order) {
    if (!map) return;
    if (!routes || Object.keys(routes).length === 0) return;

    polylines.forEach(pl => pl.setMap(null));
    polylines = [];

    markers.forEach(m => m.setMap(null));
    markers = [];

    const geocoder = new google.maps.Geocoder();

    order.forEach((locIdx, step) => {
      const placeName = locations[locIdx];
      geocoder.geocode({ address: placeName }, (results, status) => {
        if (status === "OK" && results[0]) {
          const marker = new google.maps.Marker({
            position: results[0].geometry.location,
            map,
            label: String(step + 1),
          });
          const infowindow = new google.maps.InfoWindow({
            content: `<b>${step + 1}.</b> ${placeName}`
          });
          marker.addListener("click", () => {
            infowindow.open(map, marker);
          });
          markers.push(marker);
        }
      });
    });

    for (let i = 1; i < order.length; i++) {
      const a = order[i - 1];
      const b = order[i];
      const key1 = `${a}_${b}`;
      const key2 = `${b}_${a}`;
      const polyStr = routes[key1] || routes[key2];
      if (!polyStr) continue;
      const path = google.maps.geometry.encoding.decodePath(polyStr);
      const polyline = new google.maps.Polyline({
        path,
        strokeColor: "#FF0000",
        strokeOpacity: 0.8,
        strokeWeight: 4,
        map
      });
      polylines.push(polyline);
    }
  }

  window.addEventListener("load", async () => {
    initMap();
    await loadAllRoutes();

    // ボタンイベント
    document.getElementById("showRouteBtn").addEventListener("click", () => {
      const start = document.getElementById("start").value;
      const end = document.getElementById("end").value;
      const startTime = document.getElementById("startTime").value;
      const endTime = document.getElementById("endTime").value;
      console.log("入力:", { start, end, startTime, endTime });

      // ★ここでアルゴリズムを呼び出して order を生成する（今回は仮）
      drawRouteOnMap([1, 2, 3, 4, 5, 6]);
    });
  });
  </script>
</body>
</html>
